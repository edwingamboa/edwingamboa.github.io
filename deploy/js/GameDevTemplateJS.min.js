/*! GameDevTemplateJS 0.0.1 | (c) 2013 Thomas Viktil */ 
function preload(){game.load.image("sky","assets/images/sky.png"),game.load.image("ground","assets/images/platform.png"),game.load.image("star","assets/images/star.png"),game.load.image("inventory_button","assets/images/inventory.png"),game.load.spritesheet("character","assets/sprites/character.png",32,48);for(var a=1;2>=a;a++)game.load.image("bullet"+a,"assets/images/bullet"+a+".png");game.stage.backgroundColor="#82CAFA"}function create(){game.world.setBounds(0,0,3e3,600),game.physics.startSystem(Phaser.Physics.ARCADE),platforms=game.add.group(),platforms.enableBody=!0;var a=platforms.create(0,game.world.height-64,"ground");a.scale.setTo(10,2),a.body.immovable=!0;var b=platforms.create(400,400,"ground");b.body.immovable=!0,b=platforms.create(-150,250,"ground"),b.body.immovable=!0,this.player=new Player(this.game,250,500,100,.2,300),this.game.add.existing(this.player),weapons.push(new Weapon(this.game,this.player,30,"bullet1",0,400,100)),weapons.push(new Weapon(this.game,this.player,40,"bullet2",0,500,100)),currentWeapon=0;for(var c=1;c<weapons.length;c++)weapons[c].visible=!1;stars=game.add.group(),stars.enableBody=!0;for(var d=0;12>d;d++){var e=stars.create(70*d,0,"star");e.body.gravity.y=300,e.body.bounce.y=.7+.2*Math.random()}scoreText=game.add.text(game.camera.width-300,16,"Score: 0",{fontSize:"32px",fill:"#000"}),scoreText.fixedToCamera=!0,ammoText=game.add.text(game.camera.width-300,game.world.height-50,"Ammo: 0",{fontSize:"32px",fill:"#000"}),ammoText.fixedToCamera=!0,healthLevelText=game.add.text(16,16,"Health: 100",{fontSize:"32px",fill:"#000"}),healthLevelText.fixedToCamera=!0,cursors=game.input.keyboard.createCursorKeys();var f=this.input.keyboard.addKey(Phaser.Keyboard.ENTER);f.onDown.add(nextWeapon,this),game.renderer.renderSession.roundPixels=!0,game.camera.follow(this.player),inventoryButton=game.add.button(game.camera.width-50,100,"inventory_button",displayInventory,this),inventoryButton.anchor.setTo(.5,.5),inventoryButton.fixedToCamera=!0}function displayInventory(){}function update(){game.physics.arcade.collide(this.player,platforms),game.physics.arcade.collide(stars,platforms),game.physics.arcade.overlap(this.player,stars,collectStar,null,this),cursors.left.isDown?(xDirection=-1,game.input.keyboard.isDown(Phaser.Keyboard.X)?this.player.runLeft():this.player.moveLeft()):cursors.right.isDown?(xDirection=1,game.input.keyboard.isDown(Phaser.Keyboard.X)?this.player.runRight():this.player.moveRight()):this.player.stop(),cursors.up.isDown&&this.player.body.touching.down&&this.player.jump(),cursors.up.isDown&&this.player.body.touching.down,game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR)&&weapons[currentWeapon].fire()}function nextWeapon(){currentWeapon++,currentWeapon===weapons.length&&(currentWeapon=0),weapons[currentWeapon].visible=!0,ammo=weapons[currentWeapon].numberOfBullets,ammoText.text="Ammo: "+ammo}function collectStar(a,b){b.kill(),score+=10,scoreText.text="Score: "+score}function render(){game.debug.cameraInfo(game.camera,32,32)}var game=new Phaser.Game(1200,600,Phaser.AUTO,"game",{preload:preload,create:create,update:update,render:render}),platforms,cursors,stars,score=0,ammo=10,healthLevel=100,scoreText,ammoText,healthLevelText,weapons=[],currentWeapon=0,xDirection=1,inventoryButton,Item=function(a,b,c){this.name=b,Phaser.Sprite.call(this,a,32,a.world.height-150,c)};Item.prototype=Object.create(Phaser.Sprite.prototype),Item.prototype.constructor=Item;var Player=function(a,b,c,d,e,f){Phaser.Sprite.call(this,a,32,a.world.height-150,"character"),this.speed=b,this.runningSpeed=c,this.healthLevel=d,this.game.physics.arcade.enable(this),this.body.bounce.y=e,this.body.gravity.y=f,this.body.collideWorldBounds=!0,this.animations.add("left",[0,1,2,3],10,!0),this.animations.add("right",[5,6,7,8],10,!0)};Player.prototype=Object.create(Phaser.Sprite.prototype),Player.prototype.constructor=Player,Player.prototype.update=function(){},Player.prototype.moveLeft=function(){this.body.velocity.x=-this.speed,this.animations.play("left")},Player.prototype.moveRight=function(){this.body.velocity.x=this.speed,this.animations.play("right")},Player.prototype.runLeft=function(){this.body.velocity.x=-this.runningSpeed,this.animations.play("left")},Player.prototype.runRight=function(){this.body.velocity.x=this.runningSpeed,this.animations.play("right")},Player.prototype.stop=function(){this.body.velocity.x=0,this.animations.stop(),this.frame=4},Player.prototype.jump=function(){this.body.velocity.y=-350},Player.prototype.crouch=function(){this.animations.stop(),this.frame=9};var Weapon=function(a,b,c,d,e,f,g){this.game=a,this.player=b,this.numberOfBullets=c,this.bullets=a.add.group(),this.bullets.enableBody=!0,this.bullets.physicsBodyType=Phaser.Physics.ARCADE,this.bullets.createMultiple(c,d),this.nextFire=e,this.bulletSpeed=f,this.fireRate=g,this.bullets.setAll("anchor.x",.5),this.bullets.setAll("anchor.y",1),this.bullets.setAll("outOfBoundsKill",!0),this.bullets.setAll("checkWorldBounds",!0),this.bullets.setAll("texture.baseTexture.scaleMode",PIXI.scaleModes.NEAREST),this.bullets.setAll("exists",!1)};Weapon.prototype.constructor=Weapon,Weapon.prototype.fire=function(){this.game.time.now>this.nextFire&&(currentBullet=this.bullets.getFirstExists(!1),currentBullet&&this.numberOfBullets>0&&(currentBullet.reset(this.player.x,this.player.y+30),currentBullet.body.velocity.x=this.player.body.velocity.x+this.bulletSpeed*xDirection,this.nextFire=game.time.now+this.fireRate,this.numberOfBullets--,ammo=this.numberOfBullets,ammoText.text="Ammo: "+ammo))};